<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>赞助支持 - Cloudstart 云启团队</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #4a90d9;
    --secondary: #5fa8e8;
    --bg: #f0f4f8;
    --card: #ffffff;
    --text: #333333;
    --text-light: #666666;
}

body {
    font-family: "SimSun", "Microsoft YaHei", "SimHei", sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
}

.navbar {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 0 20px;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 60px;
}

.logo {
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-decoration: none;
}

.back-link {
    color: white;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 5px;
}

.main {
    margin-top: 60px;
    padding: 40px 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 40px 0;
}

.page-header h1 {
    font-size: 36px;
    margin-bottom: 10px;
}

.page-header p {
    color: var(--text-light);
    font-size: 18px;
}

.card {
    background: var(--card);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 30px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
}

.card h2 {
    color: var(--primary);
    font-size: 28px;
    margin-bottom: 20px;
    text-align: center;
}

.card p {
    color: var(--text-light);
    line-height: 1.8;
    margin-bottom: 15px;
}

/* 爱发电按钮 */
.afdian-btn {
    display: inline-block;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 15px 40px;
    border-radius: 25px;
    text-decoration: none;
    font-size: 18px;
    font-weight: bold;
    margin: 20px 0;
    transition: transform 0.3s, box-shadow 0.3s;
}

.afdian-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(74, 144, 217, 0.4);
}

/* 金额展示 */
.amount-box {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.amount-item {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
}

.amount-item .number {
    font-size: 32px;
    font-weight: bold;
    margin-bottom: 5px;
}

.amount-item .label {
    font-size: 14px;
    opacity: 0.9;
}

/* 赞助者列表 */
.sponsors-list {
    list-style: none;
    margin: 20px 0;
}

.sponsors-list li {
    padding: 15px 20px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.3s;
}

.sponsors-list li:hover {
    background: #e9ecef;
}

.sponsors-list li::before {
    content: ">";
    color: var(--primary);
    font-weight: bold;
}

.sponsor-date {
    color: var(--primary);
    font-weight: bold;
    min-width: 100px;
}

.sponsor-name {
    color: var(--text);
}

/* 历史记录分隔 */
.history-divider {
    text-align: center;
    margin: 30px 0;
    position: relative;
}

.history-divider::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #ddd;
}

.history-divider span {
    background: var(--card);
    padding: 0 20px;
    position: relative;
    color: var(--text-light);
    font-size: 14px;
}

/* 加载状态 */
.loading, .empty, .error {
    text-align: center;
    padding: 40px;
    color: var(--text-light);
}

.update-info {
    text-align: center;
    color: var(--text-light);
    font-size: 14px;
    margin-top: 20px;
}

.footer {
    background: var(--text);
    color: white;
    text-align: center;
    padding: 40px 20px;
    margin-top: 60px;
}

.footer p {
    opacity: 0.8;
    margin: 5px 0;
}
</style>
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="logo">Cloudstart 云启</a>
        <a href="about.html" class="back-link">&lt;- 返回关于我们</a>
    </div>
</nav>

<main class="main">
    
    <div class="page-header">
        <h1>赞助支持</h1>
        <p>您的支持是我们前进的动力</p>
    </div>
    
    <!-- 赞助说明 -->
    <div class="card">
        <h2>赞助说明</h2>
        <p>CloudStart 是一个完全由小学生发起的公益开源编程团队。我们不接受商业投资，不投放广告，所有项目免费开源。

您的每一分赞助都将直接用于购买域名和服务器资源、开发工具的授权费用、团队成员的学习资料、开源项目的持续维护。赞助完全自愿，不提供任何特权或商业回报。

请点击以下链接，进入爱发电主页进行赞助。

重要说明：所有赞助均为用户自愿行为，不构成购买服务或商品，不形成任何合同关系。我们不提供任何形式的回报、特权、权益或商业承诺，包括但不限于项目决策权、优先技术支持、定制开发服务、广告位、退款或兑换。赞助资金将用于团队运营成本，包括服务器、域名、开发工具、学习资料，不会用于个人消费或商业投资。未满 18 周岁的用户赞助前必须获得监护人同意，我们建议未成年用户优先通过贡献代码、文档、设计等方式支持团队。本团队为公益性质，不具备开具发票资质，赞助视为无偿赠与，不涉及商品或服务交易。如对资金用途有疑问，请通过 cloudstart2025@163.com 联系我们。

不想赞助？这些方式同样珍贵：贡献代码，在 GitHub 提交 Pull Request；完善文档，帮助改进教程、翻译文档；设计支持，设计图标、绘制素材；测试反馈，下载使用并报告问题；传播分享，向朋友推荐我们的项目；社区互助，在讨论区回答问题。这些贡献的价值往往超过金钱赞助。

常见问题：赞助多少钱合适？任何金额都是支持，建议根据经济能力决定，学生用户请优先选择非金钱方式。赞助后可以要求退款吗？原则上不接受退款，特殊情况请邮件联系。如何知道资金用在哪里？我们每季度发布财务简报，说明收入和支出方向。我是家长，孩子想赞助怎么办？建议由家长代为操作，我们更鼓励孩子通过参与项目来支持团队。企业可以赞助吗？可以接受无偿捐赠，但不提供商业回报，企业名称可出现在感谢名单中。

对赞助有疑问？发送邮件至 cloudstart2025@163.com，标题注明"赞助咨询"，3 个工作日内回复。

CloudStart（云启）团队承诺，所有赞助仅用于团队开发和运营。本页面最后更新：2026 年 2 月 17 日。</p>
        
        <div style="text-align: center;">
            <a href="https://afdian.com/a/cloudstartoffice" target="_blank" class="afdian-btn">去爱发电赞助</a>
        </div>
    </div>
    
    <!-- 赞助者名单（自动更新） -->
    <div class="card">
        <h2>赞助者名单</h2>
        
        <div class="amount-box" id="statsBox" style="display: none;">
            <div class="amount-item">
                <div class="number" id="totalCount">0</div>
                <div class="label">赞助者</div>
            </div>
            <div class="amount-item">
                <div class="number" id="totalAmount">0</div>
                <div class="label">累计金额(元)</div>
            </div>
        </div>

        <div id="loading" class="loading">正在加载赞助名单...</div>
        <div id="empty" class="empty" style="display: none;">暂无赞助数据</div>
        <div id="error" class="error" style="display: none;">加载失败，请稍后刷新</div>

        <ul class="sponsors-list" id="sponsorsList" style="display: none;"></ul>

        <div class="update-info" id="updateInfo"></div>
    </div>
    
</main>

<footer class="footer">
    <p>(C) 2025 Cloudstart 云启团队</p>
    <p>cloudstar2025@163.com</p>
</footer>

<script>
// ==================== 配置 ====================

// Cloudflare Workers API 地址
const API_URL = 'https://api.cloudstart.xyz/api/sponsors';

// 历史记录（微信赞助，不计入统计，仅展示）
// 格式: 'YYYY-MM - 赞助者名称'
const HISTORY_RECORDS = [
    '2026-02 - 匿名赞助者*2'
];

// 历史记录总金额（微信赞助金额）
const HISTORY_AMOUNT = 101;

// ==================== 功能代码 ====================

function formatYearMonth(timeStr) {
    // 严格验证日期
    if (!timeStr || timeStr === 'null' || timeStr === 'undefined' || timeStr === '') {
        return null; // 返回 null 表示无效日期
    }
    
    const date = new Date(timeStr);
    
    // 检查日期是否有效且合理（2020年以后）
    if (isNaN(date.getTime()) || date.getFullYear() < 2020 || date.getFullYear() > 2100) {
        console.warn('Invalid date:', timeStr);
        return null;
    }
    
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    return `${year}-${month}`;
}

async function loadSponsors() {
    try {
        const response = await fetch(API_URL);
        const data = await response.json();
        
        document.getElementById('loading').style.display = 'none';
        
        if (!data.success) {
            throw new Error(data.error || 'API 返回错误');
        }
        
        // 获取 API 赞助者（爱发电）
        const apiSponsors = data.sponsors || [];
        
        // 计算统计数据
        // 注意：历史记录不计入统计，只显示爱发电的数据
        const totalCount = apiSponsors.length;
        const totalAmount = apiSponsors.reduce((sum, s) => sum + (s.amount || 0), 0);
        
        // 显示统计（爱发电数据 + 历史记录展示）
        const displayCount = totalCount;
        const displayAmount = totalAmount; // 只显示爱发电金额，历史金额单独展示
        
        document.getElementById('totalCount').textContent = displayCount;
        document.getElementById('totalAmount').textContent = Math.floor(displayAmount);
        document.getElementById('statsBox').style.display = 'grid';
        
        const listEl = document.getElementById('sponsorsList');
        let html = '';
        
        // 1. 显示 API 获取的赞助者（爱发电，最新在前）
        if (apiSponsors.length > 0) {
            apiSponsors.forEach(s => {
                const dateStr = formatYearMonth(s.lastPay);
                
                // 如果日期无效，跳过此记录（或显示为未知）
                if (!dateStr) {
                    console.warn('Skipping sponsor with invalid date:', s);
                    return;
                }
                
                // 确保有名称
                const name = s.name || '匿名赞助者';
                
                html += `<li><span class="sponsor-date">${dateStr}</span><span class="sponsor-name"> - ${name}</span></li>`;
            });
        }
        
        // 2. 显示历史记录（置底，不计入统计）
        if (HISTORY_RECORDS.length > 0) {
            html += `<div class="history-divider"><span>历史记录（微信赞助）</span></div>`;
            HISTORY_RECORDS.forEach(record => {
                const match = record.match(/^(\d{4}-\d{2})\s*-\s*(.+)$/);
                if (match) {
                    html += `<li><span class="sponsor-date">${match[1]}</span><span class="sponsor-name"> - ${match[2]}</span></li>`;
                } else {
                    html += `<li><span class="sponsor-name">${record}</span></li>`;
                }
            });
        }
        
        if (html === '') {
            document.getElementById('empty').style.display = 'block';
        } else {
            listEl.innerHTML = html;
            listEl.style.display = 'block';
        }
        
        // 更新时间
        const updateTime = new Date(data.updatedAt);
        document.getElementById('updateInfo').textContent = 
            '名单更新时间：' + updateTime.toLocaleString('zh-CN') + ' | 每6小时自动同步';
        
    } catch (error) {
        console.error('加载失败:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = '加载失败：' + error.message;
    }
}

// 页面加载时获取
loadSponsors();

// 每5分钟自动刷新
setInterval(loadSponsors, 5 * 60 * 1000);
</script>

</body>
</html>
